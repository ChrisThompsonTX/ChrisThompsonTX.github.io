<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Document</title>
</head>
<body>
   <canvas id="background"></canvas> 


    <script>
        (function () {
            let canvas = document.getElementById("background");
            // context = canvas.getContext('2d');
            // resizeWindow();

            // function resizeWindow() {
            //     window.addEventListener("resize", render, false);
            //     render();
            // }

            // function render() {
            //     canvas.width = window.innerWidth;
            //     canvas.height = window.innerHeight;
            //     ctx.clearRect(0, 0, canvas.width, canvas.height)
            // }

            // d3 = require("d3-delaunay@^5.1")
            height = 600
            n = 200
            const context = DOM.context2d(width, height);
            const positions = Float64Array.from({ length: n * 2 }, (_, i) => Math.random() * (i & 1 ? height : width));
            const velocities = new Float64Array(n * 2);
            const voronoi = new d3.Delaunay(positions).voronoi([0.5, 0.5, width - 0.5, height - 0.5]);
            context.lineWidth = 0.25;
            
            while(true) {
                context.fillStyle = "#ffffff33";
                context.fillRect(0, 0, width, height);
                context.fillStyle = "black";
                
                for (let i = 0; i < positions.length; ++i) {
                    const size = i & 1 ? height : width;
                    positions[i] += velocities[i];
                    if (positions[i] < 0) positions[i] += size;
                    else if (positions[i] > size) positions[i] -= size;
                    velocities[i] += 0.2 * (Math.random() - 0.5) - 0.01 * velocities[i];
                }
                
                context.beginPath();
                voronoi.update().render(context);
                voronoi.renderBounds(context);
                context.stroke();
                
                context.beginPath();
                voronoi.delaunay.renderPoints(context, 1);
                context.fill();
                
                // yield context.canvas;
            }
            
            
            
        })();
    </script>
</body>
</html>